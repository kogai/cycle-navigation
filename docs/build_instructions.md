# ビルドと動作確認手順

## 必要なもの

1. **ハードウェア**

   - LilyGo T5S3-4.7-e-paper-PRO
   - USB ケーブル（ボードと PC を接続するため）
   - microSD カード（オプション、マップタイル保存用）

2. **ソフトウェア**
   - Visual Studio Code
   - PlatformIO 拡張機能
   - ESP-IDF（PlatformIO が自動的にインストール）

## ビルド手順

### 1. プロジェクトのセットアップ

1. Visual Studio Code を開きます。
2. PlatformIO 拡張機能がインストールされていることを確認します。
3. プロジェクトフォルダ（`cycle-navigation`）を開きます。

### 2. 設定の確認

1. `platformio.ini`ファイルを開き、以下の設定を確認します：
   - ボード設定: `board = T5-ePaper-S3`
   - フレームワーク: `framework = arduino`
   - シリアルポート設定（必要に応じて）

### 3. ビルド

1. PlatformIO のサイドバーを開きます。
2. 「Build」ボタンをクリックしてプロジェクトをビルドします。
3. ビルドが成功すると、「SUCCESS」メッセージが表示されます。

### 4. アップロード

1. LilyGo ボードを USB ケーブルで PC に接続します。
2. ボードが正しく認識されていることを確認します。
3. PlatformIO サイドバーの「Upload」ボタンをクリックします。
4. アップロードが成功すると、「SUCCESS」メッセージが表示されます。

### 5. シリアルモニタの確認

1. アップロード後、PlatformIO サイドバーの「Serial Monitor」ボタンをクリックします。
2. シリアルモニタが開き、デバイスからのログメッセージが表示されます。
3. 初期化メッセージや各コンポーネントの状態を確認します。

## 動作確認

### 基本機能の確認

1. **起動確認**

   - デバイスの電源を入れると、起動画面が表示されます。
   - シリアルモニタに「サイクルナビゲーション起動中...」というメッセージが表示されます。

2. **ディスプレイ確認**

   - 起動後、マップ画面が表示されます。
   - バッテリー残量、GPS 信号強度などの UI 要素が表示されます。

3. **GPS 機能確認**

   - 屋外に出て、GPS 信号を受信できる環境で待ちます。
   - GPS 信号を受信すると、現在地マーカーが表示されます。
   - シリアルモニタに GPS 情報（緯度、経度、速度など）が表示されます。

4. **ボタン操作確認**
   - 上下ボタン: マップのズームイン/アウト
   - 左右ボタン: マップのスクロール
   - 選択ボタン: 現在地にフォーカス
   - 戻るボタン: 設定画面表示

### デバッグ方法

1. **シリアルログの確認**

   - シリアルモニタを開いて、デバイスからのログメッセージを確認します。
   - エラーメッセージや警告メッセージがないか確認します。

2. **電源管理の確認**

   - バッテリー残量の表示が正しいか確認します。
   - 低電力モードに移行するかどうかを確認します（一定時間操作がない場合）。

3. **GPS 機能の確認**
   - GPS 信号強度の表示が正しいか確認します。
   - 位置情報の更新が正しく行われるか確認します。

## トラブルシューティング

### ビルドエラー

1. **依存ライブラリの問題**

   - エラーメッセージを確認し、不足しているライブラリがないか確認します。
   - 必要に応じて、`platformio.ini`ファイルに依存ライブラリを追加します。

2. **コンパイルエラー**
   - エラーメッセージを確認し、コードの問題を修正します。
   - 特に、型変換や関数の引数に関するエラーに注意します。

### アップロードエラー

1. **ポート認識の問題**

   - デバイスが正しく認識されているか確認します。
   - 必要に応じて、`platformio.ini`ファイルにポート設定を追加します。
   - ドライバが正しくインストールされているか確認します。

2. **ブートモードの問題**
   - ボードがブートモードになっていない場合、アップロードに失敗することがあります。
   - BOOT ボタンを押しながらリセットボタンを押し、その後 BOOT ボタンを離すことでブートモードに入ります。

### 動作の問題

1. **ディスプレイが更新されない**

   - シリアルログでエラーメッセージを確認します。
   - ディスプレイの初期化が正しく行われているか確認します。

2. **GPS 信号を受信できない**

   - 屋外の開けた場所で試してみます。
   - シリアルログで GPS 関連のエラーメッセージを確認します。
   - GPS 機能が有効になっているか確認します。

3. **バッテリー残量が正しく表示されない**
   - シリアルログでバッテリー関連のエラーメッセージを確認します。
   - バッテリー管理チップの初期化が正しく行われているか確認します。
