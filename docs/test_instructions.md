# テスト実行手順

## 概要

このプロジェクトでは、通常のアプリケーションとテストプログラムの 2 つのモードがあります。それぞれの実行方法を説明します。

## 1. 通常アプリケーションの実行

通常のサイクルナビゲーションアプリケーションを実行するには：

1. PlatformIO のプロジェクトタスクから「T5_E_PAPER_S3_V7」環境を選択します。
2. 「Build」ボタンをクリックしてビルドします。
3. 「Upload」ボタンをクリックしてボードにアップロードします。
4. 「Monitor」ボタンをクリックしてシリアルモニタを開きます。

この設定では、`main.cpp` がメインプログラムとしてビルドされます。

## 2. テストプログラムの実行

各コンポーネントの動作を個別にテストするには：

1. PlatformIO のプロジェクトタスクから「test」環境を選択します。
2. 「Build」ボタンをクリックしてビルドします。
3. 「Upload」ボタンをクリックしてボードにアップロードします。
4. 「Monitor」ボタンをクリックしてシリアルモニタを開きます。

この設定では、`test_program.cpp` がメインプログラムとしてビルドされ、`main.cpp` は除外されます。

## テストプログラムの内容

テストプログラムは以下の順序で各コンポーネントをテストします：

1. **電源管理テスト**

   - BQ25896 と BQ27220 の初期化
   - バッテリー残量と電圧の読み取り
   - 充電状態の確認

2. **GPS テスト**

   - GPS モジュールの初期化
   - 位置情報の取得（屋外で実施推奨）
   - 速度、方位、衛星数の確認

3. **ディスプレイテスト**
   - 電子ペーパーディスプレイの初期化
   - テキストと UI 要素の描画
   - マップ表示機能の確認

## テスト結果の確認

テストプログラムは、各テストの結果をシリアルモニタに出力します。すべてのテストが完了すると、総合結果が表示されます。

```
===== テスト結果 =====
電源管理の初期化: 成功
バッテリー情報の読み取り: 成功
GPS機能の初期化: 成功
GPS情報の読み取り: 成功
ディスプレイの初期化: 成功
ディスプレイの描画: 成功

総合結果: 全テスト成功
====================
```

## 注意点

1. **GPS テスト**：屋内では GPS 信号が弱く、位置情報が取得できない場合があります。その場合、30 秒後にタイムアウトし、次のテストに進みます。

2. **ディスプレイテスト**：電子ペーパーディスプレイの更新には時間がかかります。テスト中は画面が更新されるまで待ってください。

3. **環境の切り替え**：テストと通常アプリケーションを切り替える場合は、必ず PlatformIO の環境を正しく選択してください。

## トラブルシューティング

### ビルドエラー

```
multiple definition of `io'
```

このエラーが発生した場合、`power_manager.cpp` と `main.cpp` の両方で `io` 変数が定義されています。`power_manager.cpp` の `io` 変数が `static` になっていることを確認してください。

### 実行時エラー

テスト実行中にエラーが発生した場合、シリアルモニタのログを確認して、どのコンポーネントでエラーが発生しているかを特定してください。

- 電源管理エラー：バッテリー管理チップの接続を確認
- GPS エラー：GPS モジュールの接続を確認
- ディスプレイエラー：ディスプレイの接続を確認
